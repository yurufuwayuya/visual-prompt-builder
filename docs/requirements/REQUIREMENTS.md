# Visual Prompt Builder 要件定義書

## 1. プロジェクト概要

Visual Prompt Builderは、AIプロンプト作成を視覚的に支援するWebアプリケーションです。

### ターゲットユーザー
- **初級者**: AIプロンプト作成に不慣れなユーザー
- **中級者**: より効率的にプロンプトを作成したいユーザー
- **上級者**: 複雑なプロンプトを体系的に管理したいユーザー
- **デフォルト市場**: 日本（日本語がデフォルト言語）

## 2. 機能要件

### 2.1 プロンプトテンプレート管理
- テンプレート一覧表示（グリッド/リスト切り替え）
- カテゴリー別フィルタリング
- キーワード検索機能
- お気に入り登録・管理
- 使用頻度によるソート
- プレビュー機能

### 2.2 ビジュアルエディタ
- ドラッグ&ドロップによる要素配置
- リアルタイムプレビュー
- 要素のリサイズ・回転
- レイヤー管理
- グリッドスナップ機能
- 取り消し/やり直し（Undo/Redo）
- キーボードショートカット対応

### 2.3 プロンプト生成
- ビジュアル要素からの自動変換
- パラメータのカスタマイズ
- 生成後の手動編集
- プロンプトの最適化提案
- バージョン管理

### 2.4 エクスポート/インポート
- テキスト形式（.txt）
- JSON形式（設定含む）
- クリップボードコピー
- 共有リンク生成
- PDF出力（将来実装）

### 2.5 多言語対応
- **必須**: 全コンポーネントで統一的な実装
- **デフォルト言語**: 日本語
- 対応言語: 日本語、英語
- 言語切り替えUIの常時表示
- ユーザー設定の永続化（LocalStorage）

## 3. 非機能要件

### 3.1 パフォーマンス要件
| 項目 | 目標値 | 必須値 |
|------|--------|--------|
| 初期読み込み時間 | 2秒以内 | 3秒以内 |
| API応答時間（95%tile） | 300ms以内 | 500ms以内 |
| 画像処理時間（5MB） | 2秒以内 | 3秒以内 |
| 同時接続数 | 5000 | 1000 |
| フレームレート | 60fps | 30fps |

### 3.2 可用性要件
- 稼働率: 99.9%（月間ダウンタイム約43分）
- 計画メンテナンス: 月1回、最大2時間
- エラー率: 0.1%未満
- 自動リカバリ機能

### 3.3 セキュリティ要件
- HTTPS通信の強制
- XSS対策（入力値サニタイゼーション）
- CSRF対策（トークン実装）
- SQLインジェクション対策
- ファイルアップロード検証（タイプ、サイズ、内容）
- セキュリティヘッダーの実装

### 3.4 ユーザビリティ要件
- **モバイル対応**: 完全レスポンシブデザイン
- **アクセシビリティ**: WCAG 2.1 Level AA準拠
- **最小タッチターゲット**: 44px × 44px
- **キーボードナビゲーション**: 全機能対応
- **スクリーンリーダー**: 対応
- **ブラウザ対応**: Chrome, Firefox, Safari, Edge（各最新2バージョン）

### 3.5 保守性要件
- コードカバレッジ: 80%以上
- TypeScript strictモード必須
- ドキュメント: コードと同時更新
- ログ: 構造化ログ、トレースID付与
- モニタリング: エラー監視、パフォーマンス監視

## 4. 技術要件

### 4.1 必須開発プロセス

#### 環境構築（最重要）
```bash
# これを忘れると時間を無駄にする！
npm install
cd frontend && npm install && cd ..
cd workers && npm install && cd ..
cd shared && npm install && cd ..
```

#### 開発フロー
1. Issue確認 → `/clear` コマンド実行
2. ブランチ作成: `feature/issue-XXX`
3. TDD実践: Red → Green → Refactor
4. 動作確認: 「理論上動く」は禁止
5. ログ更新: 実装ログ + 感情ログ（必須）

### 4.2 コーディング標準
- TypeScript strictモード
- 関数: 50行以内
- no any, no implicit any
- エラーは必ずtry-catch
- ユーザーフレンドリーなエラーメッセージ

### 4.3 テスト要件
- 単体テスト: 全public関数
- 統合テスト: 主要ユーザーフロー
- アクセシビリティテスト: 自動化
- パフォーマンステスト: 各機能で実施
- E2Eテスト: クリティカルパス（将来）

## 5. 制約事項

### 5.1 技術的制約
- Cloudflare Workers制限
  - CPU時間: 10ms（無料）/ 50ms（有料）
  - メモリ: 128MB
  - Node.js API使用不可（Web標準APIのみ）
- Base64画像: サイズ約33%増加
- ブラウザ: ローカルストレージ5-10MB

### 5.2 ビジネス制約
- 初期リリース: 無料版のみ
- 日本市場優先
- オープンソースライセンス互換必須

## 6. 受け入れ基準

### 6.1 機能テスト
- [ ] 全機能が仕様通り動作
- [ ] 日本語/英語切り替えが全画面で機能
- [ ] エラー時に適切なメッセージ表示
- [ ] データの永続化が正常

### 6.2 非機能テスト
- [ ] Lighthouseスコア85以上（全項目）
- [ ] 初期読み込み3秒以内
- [ ] 44px最小タッチターゲット確保
- [ ] キーボードのみで全操作可能

### 6.3 品質基準
- [ ] TypeScriptエラー: 0
- [ ] ESLintエラー: 0
- [ ] テスト成功率: 100%
- [ ] 重大度Highのバグ: 0

## 7. リスクと対策

| リスク | 影響 | 確率 | 対策 |
|--------|------|------|------|
| npm install忘れ | 高 | 高 | チェックリスト化、自動化検討 |
| 型定義不一致 | 中 | 中 | name/nameEnパターン統一 |
| パフォーマンス劣化 | 高 | 中 | 定期計測、最適化 |
| スケーラビリティ | 高 | 低 | 早期のDB/CDN導入準備 |

## 8. 用語定義

- **プロンプト**: AIモデルへの指示文
- **テンプレート**: 再利用可能なプロンプトの雛形
- **ビジュアルエディタ**: GUIでプロンプトを作成する機能
- **predefinedId**: カテゴリー等の固定ID
- **TDD**: テスト駆動開発（Test-Driven Development）

---

**作成日**: 2025-06-25  
**最終更新**: 2025-06-25  
**バージョン**: 統合版（v2ベース）