# 非機能要件書

## 1. パフォーマンス要件

### 1.1 レスポンスタイム
**要件ID**: NFR-001
**優先度**: 高
**計測方法**: パフォーマンスモニタリングツール

**要件内容**:

| 処理内容 | 目標値 | 許容範囲 | 計測条件 |
|----------|--------|----------|----------|
| ページ初期表示 | 2秒 | 3秒以内 | 4Gネットワーク |
| カテゴリ切り替え | 0.3秒 | 0.5秒以内 | ローカル処理 |
| プロンプト生成 | 0.5秒 | 1秒以内 | 翻訳APIを除く |
| 翻訳処理 | 3秒 | 5秒以内 | API応答含む |
| 画像プレビュー | 1秒 | 2秒以内 | サムネイル表示 |

**最適化方法**:
- 画像の遅延読み込み（lazy loading）
- CDNの活用
- ブラウザキャッシュの活用
- CSS/JSの最小化と圧縮

### 1.2 同時利用者数
**要件ID**: NFR-002
**優先度**: 中
**計測方法**: 負荷テストツール

**要件内容**:

| 項目 | 最小要件 | 目標値 | 備考 |
|------|----------|---------|------|
| 同時アクセス数 | 50ユーザー | 100ユーザー | ピーク時 |
| 1事業所あたり | 10ユーザー | 20ユーザー | 通常利用 |
| レスポンス劣化 | 10%以内 | 5%以内 | 負荷時 |

**スケーリング対策**:
- オートスケーリングの実装
- ロードバランサーの設置
- キャッシュサーバーの活用
- 非同期処理の最適化

### 1.3 データ処理量
**要件ID**: NFR-003

**要件内容**:
- プロンプト履歴保存: ユーザーあたり最大100件
- 1プロンプトあたりの最大文字数: 1000文字

## 2. 可用性要件

### 2.1 稼働率
**要件ID**: NFR-004

**要件内容**:
- システム稼働率: 99%以上（計画メンテナンスを除く）
- 営業時間（平日9:00-17:00）内の稼働率: 99.5%以上

### 2.2 メンテナンス
**要件ID**: NFR-005

**要件内容**:
- 計画メンテナンス: 月1回、最大2時間
- メンテナンス実施時間: 休日または深夜帯
- メンテナンス告知: 1週間前までに通知

## 3. 使いやすさ要件

### 3.1 操作性
**要件ID**: NFR-006
**優先度**: 高
**評価方法**: ユーザビリティテスト

**要件内容**:

| 評価項目 | 成功基準 | 測定方法 |
|----------|----------|----------|
| 初回理解度 | 80%以上が理解 | 5名でテスト |
| アクセシビリティ | 3クリック以内 | クリック数計測 |
| エラー復旧 | 30秒以内 | タスク完了時間 |
| 満足度 | 4.0/5.0以上 | アンケート調査 |

**設計指針**:
- 直感的なUIパターンの採用
- 適切なデフォルト値の設定
- 操作ガイドの常時表示
- プログレッシブディスクロージャー

### 3.2 学習容易性
**要件ID**: NFR-007

**要件内容**:
- 新規利用者: 10分以内で基本操作を習得
- 支援員向け: 30分以内で全機能を習得
- 操作ガイドの提供

### 3.3 エラー処理
**要件ID**: NFR-008

**要件内容**:
- エラーメッセージは日本語で表示
- 具体的な解決方法を提示
- エラー発生時もデータは保持

## 4. セキュリティ要件

### 4.1 認証・認可
**要件ID**: NFR-009
**優先度**: 高
**準拠規格**: OWASPガイドライン

**要件内容**:

| 項目 | 要件 | 理由 |
|------|------|------|
| 認証方式 | 事業所単位共有アカウント | 管理負担軽減 |
| パスワードポリシー | 8文字以上、英数字必須 | 基本的セキュリティ |
| セッション管理 | 60分タイムアウト | 適切な保護 |
| 認証失敗対策 | 5回失敗で5分ロック | ブルートフォース防止 |
| パスワード保存 | bcrypt（コスト10以上） | ハッシュ化 |

**追加セキュリティ機能**:
- 2要素認証（オプション）
- パスワード変更履歴管理
- ログイン履歴の記録

### 4.2 データ保護
**要件ID**: NFR-010

**要件内容**:
- 通信の暗号化: HTTPS必須
- 個人情報: 収集しない設計
- プロンプト履歴: ブラウザのローカルストレージに保存

### 4.3 アクセス制御
**要件ID**: NFR-011

**要件内容**:
- IPアドレス制限: 事業所単位で設定可能
- 不正アクセス防止: 連続ログイン失敗時のアカウントロック

## 5. 信頼性要件

### 5.1 データ整合性
**要件ID**: NFR-012

**要件内容**:
- プロンプト生成の一貫性を保証
- 選択内容の保存と復元の正確性
- 翻訳エラー時の元データ保持

### 5.2 障害対応
**要件ID**: NFR-013

**要件内容**:
- 自動リトライ機能（翻訳API）
- エラーログの記録
- 障害時の代替処理（キャッシュ利用等）

## 6. 保守性要件

### 6.1 コード品質
**要件ID**: NFR-014

**要件内容**:
- コーディング規約の遵守
- ユニットテストカバレッジ: 70%以上
- ドキュメントの整備

### 6.2 拡張性
**要件ID**: NFR-015

**要件内容**:
- 新しいカテゴリの追加が容易
- 選択肢の追加・変更が設定ファイルで可能
- 多言語対応への拡張を考慮

### 6.3 監視・ログ
**要件ID**: NFR-016

**要件内容**:
- アクセスログの記録
- エラーログの記録
- パフォーマンスメトリクスの収集

## 7. 移植性要件

### 7.1 プラットフォーム
**要件ID**: NFR-017

**要件内容**:
- Webブラウザ: Chrome, Firefox, Safari, Edge（最新2バージョン）
- OS非依存
- クラウド環境での動作を想定

### 7.2 デバイス対応
**要件ID**: NFR-018

**要件内容**:
- スマートフォン: iOS 14以上、Android 10以上
- タブレット: iPadOS 14以上、Android 10以上
- デスクトップ: 解像度1024x768以上

## 8. 法規制・コンプライアンス要件

### 8.1 個人情報保護
**要件ID**: NFR-019
**優先度**: 高
**準拠法令**: 個人情報保護法、GDPRガイドライン

**要件内容**:

| 対応項目 | 具体的対策 | 実装方法 |
|----------|------------|----------|
| データ最小化 | 個人情報収集を回避 | 共有アカウント制 |
| 透明性確保 | 利用規約・プライバシーポリシー明示 | 初回利用時表示 |
| 同意取得 | 明示的な同意を取得 | チェックボックス |
| データ管理 | ローカルストレージ優先 | ブラウザ保存 |
| 削除権 | データ削除機能提供 | ワンクリック削除 |

**プライバシーバイデザイン**:
- デフォルトで最もプライバシーに配慮した設定
- オプトイン方式の採用
- データの匿名化・仮名化

### 8.2 アクセシビリティ
**要件ID**: NFR-020

**要件内容**:
- JIS X 8341（WCAG 2.1）レベルAAに準拠
- 色覚異常への配慮
- スクリーンリーダー対応

## 9. 運用要件

### 9.1 バックアップ
**要件ID**: NFR-021
**優先度**: 高
**運用基準**: 3-2-1ルール

**要件内容**:

| バックアップ種別 | 頻度 | 保持期間 | 保存先 |
|--------------|------|----------|--------|
| フルバックアップ | 週次 | 4週間 | クラウドストレージ |
| 差分バックアップ | 日次 | 7日間 | ローカル |
| 設定ファイル | 変更時 | 90日間 | Gitリポジトリ |
| データベース | 6時間毎 | 30日間 | クラウド+ローカル |

**リストア要件**:
- RTO（目標復旧時間）: 4時間
- RPO（目標復旧時点）: 6時間
- リストアテスト: 月次実施
- 手順書の整備と更新

## 10. 移行・統合要件（追加）

### 10.1 既存システムからの移行
**要件ID**: NFR-023
**優先度**: 中
**適用バージョン**: 1.0

**要件内容**:
- 既存のFlask実装からの段階的移行
- データ移行ツールの提供
- 並行稼働期間の設定（2週間）
- ロールバック手順の整備

### 9.2 サポート体制
**要件ID**: NFR-022

**要件内容**:
- 操作マニュアルの提供
- FAQ・トラブルシューティングガイド
- メールサポート対応（平日9:00-17:00）