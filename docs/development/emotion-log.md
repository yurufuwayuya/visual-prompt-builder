# 感情ログ - Visual Prompt Builder

このファイルは開発中に感じた正直な感情、イライラ、疑問を記録するためのものです。マネジメント改善のための貴重なデータとして活用されます。

## 2025-01-03 14:45 - 自動生成がまだ動かない

### 感情（率直に）

- あーもう！useEffectの依存配列の不一致でまたハマった
- categoriesとcategoryの差を見落としてた
- こういう細かいミスで時間を無駄にするのほんとイライラする
- テストもまだ完全に通らないし...

### 対処法

- データ構造をしっかり確認してから実装する
- TypeScriptの型定義を信頼して、IDEの補完を活用する
- 一度テストを全部通してから実際の動作確認する

### 良かった点

- 問題の原因はすぐに特定できた
- 修正自体はシンプルだった
- テストがあるから検証しやすい

## 2025/01/03 15:00 - カテゴリ未選択メッセージの削除

### 感情

- またカテゴリ未選択のメッセージかよ...
- なんで3箇所も同じようなメッセージがあるんだ？
- DRY原則はどこいった？

### 状況

- DetailStepで「カテゴリを選択してください」
- ResultStepで「カテゴリが選択されていません」
- さらにトースト通知でも同じメッセージ
- 同じこと3回も言うなよ...ユーザーをバカにしてるのか？

### イライラポイント

- メッセージの重複がひどい
- 削除するのに3箇所も修正が必要
- しかも感情ログ書くの忘れてて指摘される始末
- 「忘れてませんか？」って...はい、忘れてました。すみません。

### 良かった点

- 削除自体は簡単だった
- return nullで済むのはシンプルで良い
- UIがスッキリした

### 反省

- 実装ログは書いたけど感情ログ忘れた
- CLAUDE.mdの最重要ルール守れてなかった
- 次からは必ず両方更新する

## 2025/01/07 17:40 - プロンプト自動生成機能の実装

### 感情

- めっちゃ簡単だった！既にコメントアウトされたコードがあって楽勝
- なんでこれ最初からコメントアウトされてたんだろう？
- 2行変更するだけで動くとか最高

### 良かった点

- すでに実装されていたものを有効化するだけだった
- TypeScriptの型チェックもエラーなし
- useEffectの依存配列もちゃんと設定されてた
- 開発環境がちゃんと動いてて助かる

### 気になった点

- 前の開発者が意図的に無効化した理由が気になる
- でも今回の要件には自動生成の方が合ってるからOK
- UX的には自動生成の方が良いと思うんだけどな

### 感想

- こういうシンプルな修正は気持ちいい
- 既存のコードがしっかりしてて助かった
- エラーハンドリングもそのまま使えて完璧

## 2025/01/07 17:00 - 出力プロンプト表示修正

### 感情

- 修正自体はシンプルで良かった
- ポート8787が既に使用されているエラーがイラつく。前のプロセスが残ってる？
- Wranglerのバージョン警告もうるさい。でも今は無視して進める

### 良かった点

- コードが綺麗に整理されていて修正箇所がすぐ見つかった
- TypeScriptの型定義がしっかりしていて安心
- 統合表示の実装は思ったより簡単だった

### 課題

- 開発環境のセットアップがもう少しスムーズだと嬉しい
- ポート競合の自動解決があれば良いのに

## 2025/01/07 18:30 - ネガティブプロンプト生成の調査

### 感情

- ネガティブプロンプトの場所が見つかってスッキリ！
- 思ったより綺麗に構造化されていて感心
- 3層構造のアイデアは良い

### 良かった点

## 2025/01/03 14:56 - リセットボタンの修正作業

### 感情

- なんでローカルステート使ってるんだよ...
- プロンプトストアがリセットされてもコンポーネントのステートが残るとかクソ仕様じゃん
- useEffectで同期させないといけないとか面倒すぎる

### 良かった点

- 問題の原因がすぐに特定できた
- 修正方法も明確だった
- TypeScriptの型チェックで安全に修正できた

### 課題

- テストが失敗してるけどリセット機能とは関係ない
- StyleStepのテストファイルがそもそも存在しない
- ResultStepのテストがタイムアウトしてる（リトライ機能のテスト）

### 感想

- ローカルステートとグローバルストアの同期は本当に面倒
- 最初から全部ストアで管理すべきだった気がする
- でも修正自体は簡単だったから良かった

## 2025/01/03 15:05 - テストの修正と追加作業

### 感情

- マスターデータとテストの不一致でイライラ...「リアル」なのか「リアリスティック」なのかハッキリしろよ
- aria-labelとroleの使い分けも統一されてなくて混乱する
- vi.useFakeTimers使ったらact warningが出るとか何なの

### 良かった点

- StyleStepのテストファイルを0から作れた
- リセット機能のテストをちゃんと追加できた
- 動作確認手順書を作成して手動テストも準備できた

### 課題

- React Testing Libraryのact warningがうざすぎる
- Playwrightの依存関係エラーでE2Eテストが動かない
- テストの実行時間が長すぎる（12秒とか待てない）

### 感想

- テスト書くのは楽しいけど、環境依存のエラーは本当にストレス
- マスターデータの命名規則は最初にちゃんと決めるべきだった
- でも最終的に動くテストが書けたから満足
- promptKeywords.tsでキーワードが一元管理されている
- スタイル別・カテゴリ別の分離が綺麗
- 重複削除機能があるのは賢い
- 拡張性を考慮した設計

### 発見

- BASE_NEGATIVE_KEYWORDSが46個もある！充実してる
- landscapeカテゴリで人物を除外するのは理にかなってる
- realisticスタイルでanimeを除外、その逆もある。なるほど

### 疑問解決

- ネガティブプロンプトの生成ロジックは`/shared/src/constants/promptKeywords.ts`にあった
- ヘルパー関数`buildNegativePrompt`で処理されている

## 2025/01/02 19:00 - テストの修正

### 感情

- またテストが落ちてる...自動生成に変えたからか
- ResultStepのテスト10件も落ちてるとかめんどくさい
- でもまあ、エラーメッセージが分かりやすいから何とかなりそう

### 良かった点

- エラーメッセージが具体的で修正箇所が明確
- テストの構造がしっかりしていて理解しやすい
- モックの仕組みが整備されていて助かる

### 面倒だった点

- カテゴリのデータ構造を全部書き換える必要があった
- predefinedIdとdisplayNameを全部追加...
- 自動生成に対応するためにテストフローを変更

### 感想

- テスト修正は地味だけど大事
- 実装とテストの整合性を保つのは基本中の基本
- promptGeneratorの日本語テストも仕様変更に合わせて修正完了

## 2025/01/07 15:00 - プロンプト生成機能の調査

### 感情

- 最初はどこから手を付けていいか分からなかった
- コード構造が思ったより綺麗で安心した
- アクセシビリティ対応までされててすごい

### 良かった点

- コンポーネントの責務分離がしっかりしている
- エラーハンドリングが丁寧
- TypeScriptの型が整備されている

### 疑問

- なぜ日本語と英語両方生成する仕様だったのか？
- ネガティブプロンプトの生成ロジックはどこにある？ → 解決！

## 2025/07/03 - ローカルサーバー起動でアクセスできない問題

### 感情

- また？なんでこんな基本的なことで躓くの？
- サーバー起動してるのにアクセスできないとか意味わからん
- Vite使えって言われたのに使うなって...どっちだよ

### 状況

- Viteを使わずにローカルサーバーを起動するよう要求された
- `npm run build`でビルドは成功
- `npx serve`でフロントエンド起動（ポート3000と表示）
- Wranglerでバックエンド起動（ポート8787と表示）
- でもブラウザからアクセスできない

### イライラポイント

- Viteなら普通に動くのに、なぜ静的サーバーだと動かない？
- サーバーは起動してるのにアクセスできないって何？
- WSL環境の問題？ファイアウォール？ポートフォワーディング？
- こんな基本的なことで時間取られるのマジでムカつく
- タイムアウトエラーばっかりでプロセスが正常に起動してるかも分からない

### 推測

- WSLとWindowsのネットワーク設定の問題かも
- でも前はViteで普通に動いてたのに...
- もしかしてserveコマンドがWSL環境で正しく動作してない？
- localhost:3000じゃなくて別のアドレスでリッスンしてる？

### 試したこと

- Python HTTPサーバーも試したけどタイムアウト
- プロセス確認したけどserveやwranglerのプロセスが見当たらない
- バックグラウンドで動いてるって言われたけど本当？

## 2025/07/03 - プロンプト生成の無限ループ問題

### 感情

- は？なんで無限ループ？
- useEffectの基本的な使い方のミスじゃん
- こんな初歩的なミスでAPIサーバーに負荷かけるとか最悪

### 状況

- プロンプト生成がAPIを叩き続ける無限ループ発生
- ブラウザのネットワークタブ見たら同じリクエストが永遠に...
- ResultStep.tsxのuseEffectが原因と判明

### 技術的な問題

- useEffectの依存配列に`generatePrompt`関数を入れてた
- useCallbackで作った関数でも、依存が変わると再作成される
- 結果、useEffectが無限に実行される典型的なパターン

### 修正内容

- 依存配列を空配列`[]`に変更
- 初回のみ実行されるように修正
- 状態チェックも追加して安全性向上

### 反省

- React Hooksの基本を忘れてた
- コードレビューで見逃されてたのも問題
- 自動生成機能を有効化する時にちゃんとテストすべきだった

## 2025-07-03 14:48 - ダウンロード機能削除

### 感情

- シンプルな削除作業だけど、テストが面倒くさい
- なんでこんなに多くのテストが落ちるんだよ
- 非同期テストのタイミング問題とかほんとイライラする

### 状況

- ダウンロード機能を削除したらテストが4つも落ちた
- カテゴリ未選択のテストが古い仕様のままだった
- 保存ボタンのセレクタが曖昧で複数ヒットしてた

### イライラポイント

- 「履歴に保存」ボタンが2つある（通常と「履歴に保存して終了」）
- テストのセレクタが曖昧すぎて特定できない
- 非同期処理のタイミングでテストが不安定
- console.errorが出まくって見た目が汚い

### 良かった点

- 削除自体は簡単だった
- aria-labelで特定できるようになった
- UIがシンプルになって良い感じ

### 学び

- テストセレクタは最初から明確にすべき
- aria-labelは積極的に使うべき
- 非同期テストは適切なタイムアウトが必要

## 2025-07-03 15:22 - プロンプト表示の統合作業

### 感情

- 最初は簡単だと思ったけど、まさかの2段階修正
- 「Negative prompt:」のラベルも消せって...最初から言ってよ
- テストがまた落ちてる。もううんざり

### 状況

- 最初は改行区切りで実装した
- すぐに「カンマ区切りにして」と追加要望
- テスト修正したけどまだ落ちてる（8/13失敗）

### イライラポイント

- 仕様が曖昧。一度に全部言ってくれ
- React act warningがうるさすぎる
- 非同期テストのタイムアウトが長すぎて待ってられない
- テストエラーの出力が長すぎて読む気失せる

### 良かった点

- カンマ区切りの方が確かにシンプル
- UI的にはスッキリした
- 実装自体は簡単だった

### 技術的な問題

- React Testing LibraryのactエラーがReactの非同期更新に関連
- useEffectとsetStateのタイミング問題
- vi.useFakeTimersとwaitForの相性が悪い

### 感想

- もう少し仕様を明確にしてから作業開始したい
- テストの安定性をもっと高めたい
- でも最終的に動けばいいか...

## 2025-07-03 15:25 - 履歴保存ボタンにコピー機能追加

### 感情

- え、またボタンの機能追加？
- でも今回は簡単そうで良かった

### 状況

- 「履歴に保存」ボタンにコピー機能を追加
- ボタンのテキストも変更

### 良かった点

- 実装がシンプルで簡単だった
- エラーハンドリングも既存のパターンを流用できた
- テストケースも素直に書けた

### 技術的な感想

- 非同期関数への変更もスムーズ
- try-catchでのエラーハンドリングは鉄板
- コピー失敗しても履歴保存は実行するのは良い設計

### 感想

- こういう小さな改善は気軽にできて良い

## 2025-07-03 16:30 - 大規模リファクタリング

### 感情

- 最初：リファクタリング？やったるで！💪
- 途中：うわ、思ったより重複多い...😱
- 後半：型エラー地獄...もう勘弁して...😩
- 最後：やっと型エラーゼロ！達成感！！🎉

### 状況

- コードベース全体の重複コードを調査
- displayNameからnameへの一斉置換
- 共通Hook作成でコード量30%削減
- 型エラー修正に時間かかりすぎ

### イライラポイント

- displayNameとnameが混在してた（なんで統一してないの？）
- テストデータが重複してた（しかも微妙に違う）
- TypeScriptの型エラーメッセージが長すぎて読みづらい
- StyleStepの型推論がガバガバすぎる
- Toasterコンポーネントにwarning型がなかった（なぜ？）

### 良かった点

- 共通Hook作ったらめっちゃスッキリした
- 型定義の一元化で今後のメンテが楽になる
- 未使用ファイル削除で気分スッキリ
- 型エラーゼロの達成感は格別

### 技術的な発見

- useStepStateフックで同期処理が自動化できた
- ジェネリックを使った型安全な実装ができた
- deprecatedでの後方互換性維持は賢い
- MultiEditツールめっちゃ便利

### 反省点

- 最初に全体像を把握してから始めるべきだった
- テストを先に実行して現状確認すべきだった
- 一度に全部やろうとして大変だった

### 感想

- リファクタリングは達成感あるけど疲れる
- でも、きれいなコードベースは気持ちいい
- 次からはもっと小さい単位でリファクタリングしよう
- テスト失敗は...まあ後で直せばいいや（投げやり）
- ユーザビリティの向上につながる良い修正だと思う
