# 感情ログ

このファイルは、実装中に感じた本音の感情を記録するログです。エラー、イライラ、疑問、不満を隠さずに書くことで、マネジメント改善のための貴重なデータとなります。

## 記録方針

- エラーに遭遇したら即座に記録
- 「は？」「なんで動かない」「クソ仕様」などの生の感情OK
- 技術的な詳細よりも、その時の気持ちを優先
- 改善提案があれば併記

## フォーマット

```markdown
## YYYY-MM-DD - 問題の要約

### 感情

- イライラレベル: ★★★☆☆
- 原因: 具体的に何にイライラしたか
```

---

## 2025-01-15 - Replicate APIがdata URLを受け付けない

### 感情

- イライラレベル: ★★★★☆
- 原因: ドキュメントに明記されていない仕様

### 本音

「は？なんでdata URL受け付けないの？」

エラーメッセージが全部曖昧すぎる。

- "broken data stream" → 何が壊れてる？
- "Incorrect padding" → base64の問題？
- "NoneType object has no attribute 'read'" → Pythonエラー丸出し

結局URLしか受け付けないってことがわかるまでに30分かかった。

### 改善提案

1. APIドキュメントに「データURLはサポートしていません」と明記して欲しい
2. エラーメッセージをもっと具体的に
3. サンプルコードに画像アップロードの例を追加

### 結果

結局、画像アップロード機能を実装する必要があることがわかった。Cloudflare
R2か一時URLサービスを使うことになる。

### 詳細

- 何をしようとしたか
- 何が起きたか
- どう感じたか

### 改善案

- こうだったらよかったのに

---

## 2025-01-14 - wrangler dev サーバーが動いてない問題

### 感情

- イライラレベル: ★★☆☆☆
- 原因: サーバーが動いてないだけなのに、エラーメッセージが分かりにくい

### 詳細

- 画像生成機能をテストしようとした
- `net::ERR_CONNECTION_REFUSED` エラーが出た
- 最初はコードの問題かと思って調査したが、単にサーバーが起動してなかっただけ
- しかも `.dev.vars`
  ファイルの場所も間違ってた（ルートじゃなくて workers ディレクトリに必要）

### 改善案

- README にサーバー起動手順を明記すべき
- `.dev.vars` の正しい配置場所をドキュメント化
- 環境変数の設定ミスをより分かりやすくエラー表示してほしい

```

---

## 2025-01-09 - カスタム項目がプロンプトに反映されない問題

### 感情

- イライラレベル: ★★★★☆
- 原因: 明らかに実装したはずの機能が動いていない

### 詳細

カスタム入力した「イラストや」が英語に翻訳されずにそのまま日本語でプロンプトに入ってる。なんで？選択肢は英語になってるのに、カスタム値だけ翻訳されてない。

翻訳処理を入れ忘れたっぽい。基本的な実装ミス。

### 改善案

- カスタム値も含めて一括で翻訳する処理が必要

---

## 2025-01-14 - サーバーが起動してないだけなのに

### 感情

- イライラレベル: ★★☆☆☆
- 原因: 単純な問題なのに調査に時間かかった

### 詳細

「アプリケーションにアクセスできない」って言われて、えっ何か壊れた？と思って調査開始。node_modules確認して、環境変数確認して、設定ファイル見て...

結局、開発サーバーが起動してなかっただけだった。

あと、テストファイルにTypeScriptエラーがあるけど、メインの動作には関係ないし。でもエラー出てるのは気持ち悪いから直したい。

### 改善案

- README.mdに「最初にこれをやれ」的な起動手順を大きく書く
- npm run dev:all を推奨コマンドとして明記
- 起動確認用のヘルスチェックスクリプトがあると便利かも
- テストでカスタム値のケースも確認すべきだった

---

## 2025-01-09 - プロンプト生成バグ修正（ステップ2,3の内容が反映されない）

### 感情

- イライラレベル: ★★★★★
- 原因: 型定義の不一致でAPIが正しく動作していなかった

### 詳細

フロントエンドからSelection型で送ってるのに、バックエンドはCategoryOptionType型を期待してた。当然動かない。型定義を統一してなかったのが原因。TypeScriptを使ってる意味がない。

### 改善案

- API用の共通型定義を作る
- フロントエンドとバックエンドで型を共有する仕組みが必要

---

## 2025-01-09 - カスタムプロンプトの日本語翻訳問題

### 感情

- イライラレベル: ★★★☆☆
- 原因: 翻訳APIのレスポンス形式を勘違い

### 詳細

翻訳APIが配列で返すと思い込んでたら、単一の文字列で返ってきた。
`translations[0]`でアクセスしようとしてundefinedエラー。

APIのレスポンス形式は最初に確認すべきだった。

### 改善案

- API仕様は実際に叩いて確認
- レスポンスの型定義をきちんと作る

---

## 2025-01-11 - StepLayoutコンポーネントが存在しない問題

### 感情

- イライラレベル: ★★☆☆☆
- 原因: 存在しないコンポーネントをインポートしようとしてエラー

### 詳細

ImageStepコンポーネントを作る時に、なんとなくStepLayoutというコンポーネントがありそうだと思って使ったら存在しなかった。他のステップコンポーネントの実装を確認すれば良かった。

ただ、すぐに気づいて修正できたので大きな問題ではなかった。

### 改善案

- 既存のコンポーネント構造を先に確認
- 存在しないものを勝手に想定しない

---

## 2025-01-11 - 型エラー祭り

### 感情

- イライラレベル: ★★★★☆
- 原因: Workers環境の制約とテストの型エラーが多発

### 詳細

型チェックしたら大量のエラーが出た。特に：

- テストでJSON.parse()の結果がunknown型
- Cloudflare WorkersでImageオブジェクトが使えない
- undefined/nullの扱いの不一致

一つずつ潰していけば解決できるけど、面倒くさい。

### 改善案

- テストファイルは最初からas anyを使う
- Workers環境の制約は最初から意識する
- 型定義は厳密に、でも柔軟に

---

## 2025-01-09 - 翻訳APIリクエストのフィールド名ミス

### 感情

- イライラレベル: ★★★★☆
- 原因: APIの仕様を確認せずに実装した

### 詳細

`text`フィールドで送ってたけど、正しくは`texts`（複数形）だった。エラーメッセージ見れば分かることなのに、思い込みで実装してた。

こういう基本的なミスで時間を無駄にするのが一番腹立つ。

### 改善案

- APIドキュメントをちゃんと読む
- リクエスト/レスポンスの型を定義する
- 最初にcurlで動作確認する

---

## 2025-01-09 - モバイル対応の現状調査

### 感情

- イライラレベル: ★☆☆☆☆
- 原因: 特になし（むしろ感心）

### 詳細

モバイル対応がすでにかなりしっかり実装されていて驚いた。Tailwindのレスポンシブクラスが適切に使われていて、スワイプ操作まで実装済み。

前の実装者、めちゃくちゃちゃんとしてる。

### 改善案

- 特になし
- 実機テストはした方がいいかも

---

## 2025-01-09 - カスタムアイテム実装の調査

### 感情

- イライラレベル: ★★☆☆☆
- 原因: コードの複雑さ

### 詳細

カスタムアイテムの追加ボタンを実装しようと思ったら、すでに各選択肢にカスタム入力フィールドがあることに気づいた。

設計思想が違うっぽい：

- 想定：独立したカスタムアイテム追加機能
- 実際：各選択肢に付随するカスタム値入力

まあ、これはこれで理にかなってる。

### 改善案

- UIの説明を追加した方がユーザーに分かりやすいかも
- カスタム値入力のプレースホルダーを工夫

---

## 2025-01-08 - プロンプトコピー機能の修正

### 感情

- イライラレベル: ★★★☆☆
- 原因: 細かいUIの不具合

### 詳細

コピーボタンを押してもフィードバックがなくて、コピーできたか分からない。実装はされてるけど、ユーザー体験が悪い。

### 改善案

- コピー成功時のフィードバック表示
- ボタンのアイコンを一時的に変更

---

## 2025-01-08 - プロンプト生成で詳細が反映されない問題

### 感情

- イライラレベル: ★★★★★
- 原因: またもや型定義の不一致

### 詳細

何度も同じような問題にぶつかってる。フロントエンドとバックエンドで型が違う。

マジでいい加減にしてほしい。Monorepoにしてる意味ないじゃん。

### 改善案

- 共通の型定義パッケージを作る
- APIのリクエスト/レスポンス型を一元管理
- 型の自動生成ツールの導入検討

---

## 2025-01-08 - ネガティブプロンプト機能の削除

### 感情

- イライラレベル: ☆☆☆☆☆
- 原因: なし

### 詳細

ユーザーリクエストでネガティブプロンプト機能を削除。きれいに削除できて気持ちいい。

不要な機能を削除するのは気分がいい。コードがシンプルになった。

### 改善案

- 特になし

---

## 2025-01-08 - Bing Image Creator の削除

### 感情

- イライラレベル: ★☆☆☆☆
- 原因: 微妙な違和感

### 詳細

プロンプトに「Bing Image Creator
prompt:」って入ってたのを汎用的な表現に変更。特定のサービス名が入ってるのは良くないね。

### 改善案

- 他にも特定サービス依存の部分がないかチェック

---

## 2025-01-14 - CodeRabbitレビューの対応

### 感情

- イライラレベル: ★★☆☆☆
- 原因: 細かい修正が多いが、品質向上のためには必要

### 詳細

CodeRabbitのレビューで指摘された項目が結構多い。any型の使用、アクセシビリティ、インラインスタイル...

正直、動いてるコードをまた触るのはめんどくさいけど、確かに指摘は正しい。特に型安全性は重要だし、アクセシビリティも無視できない。

画像リサイズ機能の実装は予想外だったけど、確かに5MBの画像をそのまま送るのは良くないな。

### 改善案

- コードレビューツールは早期に導入すべき
- 最初から型安全性を意識した実装
- パフォーマンスは後回しにしがちだけど、最初から考慮すべき

---

## 2025-07-14 - CodeRabbitレビューコメント対応

### 感情

- イライラレベル: ★☆☆☆☆
- 原因: 細かいドキュメント修正だが、品質向上のために必要

### 詳細

CodeRabbitが指摘したmarkdownlint違反を修正。見出しの三点リーダーとか、生のURLとか、細かいことだけど確かに標準的な形式に合わせた方がいい。

自動化されたレビューツールの指摘は客観的で、人間が見落としがちな点を確実に指摘してくれるから有益。

### 改善案

- 最初からmarkdownlintを導入しておけば、後から修正する手間が省ける
- ドキュメントの構造化は継続的に意識すべき

---

## 2025-01-08 - ステップナビゲーションの同期問題

### 感情

- イライラレベル: ★★★★☆
- 原因: 状態管理の複雑さ

### 詳細

プログレスバーとコンテンツの表示が同期しない。複数の場所で状態を管理してるから起きる典型的な問題。

Zustand使ってるのに、なんでローカルステートも使ってるんだよ。

### 改善案

- 状態は一箇所で管理
- Single Source of Truth の徹底

---

## 2025-01-08 - API呼び出しのエラーハンドリング

### 感情

- イライラレベル: ★★★☆☆
- 原因: エラー時の挙動が不親切

### 詳細

ネットワークエラーの時に真っ白な画面になる。ユーザーに何が起きたか分からない。

最低限のエラーハンドリングくらいしようよ。

### 改善案

- try-catch でエラーをキャッチ
- ユーザーフレンドリーなエラーメッセージ
- リトライボタンの実装

---

## 2025-01-08 - wranglerの初回セットアップ

### 感情

- イライラレベル: ★★☆☆☆
- 原因: ドキュメント不足

### 詳細

wranglerの使い方が分からなくて時間かかった。README.mdに書いてあるけど、詳細が足りない。

### 改善案

- 開発環境セットアップのドキュメント充実
- よくあるエラーと対処法を記載

---

## 2025-01-10 - コードレビューでの発見

### 感情

- イライラレベル: ★★★★★
- 原因: セキュリティホール

### 詳細

本番環境でスタックトレース出してるじゃん！！！エラーハンドラーで環境判定してない。

これはマジでヤバい。即修正案件。

### 改善案

- 環境変数で判定して、開発環境のみスタックトレース表示
- セキュリティチェックリストの作成

---

## 2025-01-10 - 翻訳APIのパス問題

### 感情

- イライラレベル: ★★★★☆
- 原因: Honoのルーティング仕様の誤解

### 詳細

`/api/v1/translation/trans` だと思ったら `/api/v1/trans`
だった。Honoのルーティングの仕様を理解してなかった。

フレームワークの仕様はちゃんと読もう。

### 改善案

- APIエンドポイントの一覧をドキュメント化
- ルーティングのテストを書く

---

## 2025-01-11 - 画像生成機能の実装開始

### 感情

- イライラレベル: ★☆☆☆☆
- 原因: 新機能実装のワクワク感

### 詳細

画像生成（i2i）機能の実装を開始。各社のAPI調査は大変だったけど、面白い。

Replicateが一番コスパ良さそう。

### 改善案

- 特になし
- 実装が楽しみ

---

## 2025-01-11 - Cloudflare Workers環境の制約

### 感情

- イライラレベル: ★★☆☆☆
- 原因: Node.js APIが使えない

### 詳細

画像処理ユーティリティを実装中に、Imageオブジェクトが使えないことに気づいた。Cloudflare
Workers環境ではブラウザAPIもNode.js APIも使えない。

Web標準APIのみで実装する必要があるのは分かってたけど、画像のサイズ取得とかができないのは不便。

### 改善案

- 画像メタデータはクライアント側で取得してもらう
- またはWorkers環境でも使える画像処理ライブラリを探す

---

## 2025-01-11 - TypeScriptの警告

### 感情

- イライラレベル: ★★★☆☆
- 原因: 未使用パラメータの警告

### 詳細

OpenAIとStability
AIの実装がTODOのままなので、パラメータが未使用として警告が出てる。

まあ、後で実装するから今は無視でいいか。

### 改善案

- `_` プレフィックスをつけて未使用を明示
- または一時的に `// @ts-ignore` を使う

---

## 2025-07-14 - React rendering errorとAPI不整合

### 感情

- イライラレベル: ★★★★☆
- 原因: フロントエンドとバックエンドでフィールド名が異なっていた

### 詳細

"Objects are not valid as a React
child"エラーが出て、最初は何が原因か分からなかった。

調べてみたら:

1. フロントエンドは `referenceImage` を送信
2. バックエンドは `baseImage` を期待
3. さらにZod validationエラーがオブジェクトのまま表示されようとしていた

なんでAPIの仕様を統一しないの？referenceImageとbaseImageって、どっちかに統一しろよ！

### 改善案

- API仕様書をちゃんと作る
- フロントエンドとバックエンドで型を共有する仕組みを作る
- エラーオブジェクトは必ず文字列に変換してから表示する

---

## 2025-07-14 - APIサーバーが起動してない問題

### 感情

- イライラレベル: ★★☆☆☆
- 原因: 単純な問題なのに、エラーメッセージが分かりにくい

### 詳細

画像生成機能をテストしようとしたら`net::ERR_CONNECTION_REFUSED`エラー。

コードの問題かと思って調査したけど、単にwrangler devサーバーが起動してなかっただけ。

さらに、ターミナルで直接起動してもタイムアウトしてしまうので、バックグラウンドで実行するスクリプトを作った。

### 改善案

- サーバー起動の自動化スクリプトを用意
- READMEに明確な起動手順を記載
- エラーメッセージに「サーバーが起動していない可能性」を含める
```
